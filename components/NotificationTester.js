import React, { useState, useEffect } from 'react';
import { View, Text, Button, StyleSheet, Alert } from 'react-native';
import {
  areNotificationsEnabled,
  enableNotifications,
  disableNotifications,
  toggleNotifications,
  debugScheduledNotifications,
  scheduleNotificationForArtist
} from '../utils/notificationHelper';

export default function NotificationTester() {
  const [enabled, setEnabled] = useState(false);

  useEffect(() => {
    areNotificationsEnabled().then(setEnabled);
  }, []);

  const handleToggle = async () => {
    const result = await toggleNotifications();
    setEnabled(result);
    Alert.alert('Notifikace', result ? 'Notifikace jsou ZAPNUT√â' : 'Notifikace jsou VYPNUT√â');
  };

  const handleDebug = async () => {
    await debugScheduledNotifications();
    Alert.alert('Debug', 'Vyps√°ny napl√°novan√© notifikace do konzole');
  };

const handleTestNotification = async () => {
  const fakeArtistId = 999;
  const startTime = new Date(Date.now() + 16 * 60 * 1000); // 20 minut do budoucnosti
  const fakeProgramData = [{
    interpret_id: fakeArtistId,
    start: startTime.toISOString(),
    stage_name: 'TEST STAGE'
  }];
  const fakeArtists = [{ id: fakeArtistId, name: 'Testovac√≠ interpret' }];
  await scheduleNotificationForArtist(fakeArtistId, fakeArtists, fakeProgramData);
  Alert.alert('‚úÖ', 'Testovac√≠ notifikace napl√°nov√°na za 5 minut (vystoup√≠ za 20 min).');
};


  return (
    <View style={styles.container}>
      <Text style={styles.title}>üîî Test Notifikac√≠</Text>
      <Text style={styles.status}>
        Stav: {enabled ? '‚úÖ Zapnuto' : '‚ùå Vypnuto'}
      </Text>

      <View style={styles.buttonGroup}>
        <Button title="üîÑ P≈ôepnout notifikace" onPress={handleToggle} />
        <Button title="üìã Debug napl√°novan√Ωch" onPress={handleDebug} />
        <Button title="üöÄ Testovac√≠ notifikace" onPress={handleTestNotification} />
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    padding: 20,
    backgroundColor: '#002239',
    marginTop: 30,
    borderRadius: 10,
  },
  title: {
    color: '#fff',
    fontSize: 20,
    fontWeight: '700',
    marginBottom: 10,
    textAlign: 'center',
  },
  status: {
    color: '#ccc',
    marginBottom: 20,
    textAlign: 'center',
  },
  buttonGroup: {
    gap: 10,
  },
});
